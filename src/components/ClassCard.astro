---
import type { TClassListing } from '../data/classes'
import { paymentURL } from '../data/classes'
import Image from 'astro/components/Image.astro'

const { classData } = Astro.props as { classData: TClassListing }

// Format date
const dateObj = new Date(classData.upcoming.date)
const formattedDate = dateObj.toLocaleDateString('en-US', {
  weekday: 'short',
  month: 'short',
  day: 'numeric',
})
const formattedTime = dateObj.toLocaleTimeString('en-US', {
  hour: '2-digit',
  minute: '2-digit',
})
---

<div
  data-class-card
  class="w-full border relative rounded-md overflow-hidden shadow-md"
>
  <div
    class="absolute bg-black/60 rounded-bl-lg p-2 text-white top-0 right-0 z-40"
  >
    <p class="text-base">{classData.duration}</p>
  </div>

  <a
    href={classData.upcoming.url}
    target="_blank"
    rel="noopener noreferrer"
    class="relative"
  >
    <div class="group overflow-hidden h-60 relative">
      <div
        class="transition-colors absolute inset-0 bg-black/50 group-hover:bg-black/0 pointer-events-none z-10"
      >
      </div>
      <Image
        data-class-image
        src={classData.image}
        alt={classData.title}
        width="240"
        height="400"
        class="transition-transform w-full h-full object-cover object-top group-hover:scale-100 scale-110"
      />
    </div>
  </a>

  <div class="p-2 md:px-6 md:py-4">
    <a href={classData.upcoming.url} target="_blank" rel="noopener noreferrer">
      <h2 class="inline-block mb-1">{classData.title}</h2>
    </a>
    <p class="text-base font-semibold">{formattedDate} â€¢ {formattedTime}</p>
    <p class="text-base mt-2">{classData.description}</p>

    <div class="mt-4 flex gap-2 items-center justify-center">
      <p class="opacity-50 font-light mr-auto">${classData.price}</p>
      <a
        href={classData.upcoming.url}
        target="_blank"
        rel="noopener noreferrer"
        class="p-2 bg-red-400 text-white rounded-sm py-3 px-8 md:px-12 text-center"
      >
        Sign up
      </a>
      <a
        href={paymentURL}
        target="_blank"
        rel="noopener noreferrer"
        class="p-2 text-purple border-purple rounded-sm border py-3 px-12 text-center"
      >
        Pay
      </a>
    </div>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const cards = document.querySelectorAll('[data-class-card]')

    cards.forEach((card) => {
      const image = card.querySelector('[data-class-image]')
      const links = card.querySelectorAll('a')

      links.forEach((link) => {
        link.addEventListener('mouseenter', () => {
          image?.classList.add('scale-100')
          image?.classList.remove('scale-110')
        })
        link.addEventListener('mouseleave', () => {
          image?.classList.add('scale-110')
          image?.classList.remove('scale-100')
        })
      })
    })
  })
</script>
