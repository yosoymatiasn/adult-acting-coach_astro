---
import type { TClassListing } from '../data/classes'
import { paymentURL } from '../data/classes'
import Image from 'astro/components/Image.astro'
import { getFormattedDate } from '../helpers/listingHelpers'

const { classData } = Astro.props as { classData: TClassListing }

const [formattedDate, formattedTime] = getFormattedDate(classData.upcoming.date)
---

<div
  data-class-card
  class="w-full border relative rounded-md overflow-hidden shadow-md"
>
  <div
    class="absolute bg-black/60 rounded-bl-lg p-2 text-white top-0 right-0 z-40"
  >
    <p class="text-base">{classData.duration}</p>
  </div>

  <a
    href={classData.upcoming.url}
    target="_blank"
    rel="noopener noreferrer"
    class="class-link relative"
  >
    <div class="group overflow-hidden h-60 relative">
      <div
        class="transition-colors absolute inset-0 bg-black/50 group-hover:bg-black/0 pointer-events-none z-10"
      >
      </div>
      <Image
        data-class-image
        src={classData.image}
        alt={classData.title}
        width="240"
        height="400"
        class="transition-transform w-full h-full object-cover object-top group-hover:scale-100 scale-110"
      />
    </div>
  </a>

  <div class="p-2 md:px-6 md:py-4">
    <a
      href={classData.upcoming.url}
      target="_blank"
      rel="noopener noreferrer"
      class="class-link"
    >
      <h2 class="inline-block mb-1">{classData.title}</h2>
    </a>
    <p class="text-base font-semibold">{formattedDate} â€¢ {formattedTime}</p>
    <p class="text-base mt-2">{classData.description}</p>

    <div class="mt-4 flex gap-2 items-center justify-center">
      <p class="opacity-50 font-light mr-auto">${classData.price}</p>
      <!-- <a
        href={classData.upcoming.url}
        target="_blank"
        rel="noopener noreferrer"
        class="p-2 bg-red-400 text-white rounded-sm py-3 px-8 md:px-12 text-center"
        onclick={`window.dispatchEvent(new CustomEvent('open-class-modal', { title: ${classData.title} }))`}
      >
        Sign up
      </a> -->
      <a
        href={paymentURL}
        target="_blank"
        rel="noopener noreferrer"
        class="class-link inline-block bg-red-400 hover:bg-purple text-white font-semibold rounded-md py-3 px-12 text-center shadow-md transition-colors duration-200"
      >
        Sign up
      </a>

      <a
        href={classData.upcoming.url}
        target="_blank"
        rel="noopener noreferrer"
        class="inline-block text-sm border border-purple text-purple hover:underline rounded-md py-2 px-6 text-center transition-all duration-200"
      >
        More details
      </a>
    </div>
  </div>
</div>

<script>
  const cards = document.querySelectorAll('[data-class-card]')

  cards.forEach((card) => {
    const image = card.querySelector('[data-class-image]')
    const links = card.querySelectorAll('.class-link')

    links.forEach((link) => {
      link.addEventListener('mouseenter', () => {
        image?.classList.add('scale-100')
        image?.classList.remove('scale-110')
      })
      link.addEventListener('mouseleave', () => {
        image?.classList.add('scale-110')
        image?.classList.remove('scale-100')
      })
    })
  })
</script>
